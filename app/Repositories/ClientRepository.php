<?php
namespace App\Repositories; use App\Models\Client; use App\Models\ClientRegion; use Yajra\DataTables\Facades\DataTables; class ClientRepository extends BaseRepository { protected $model; protected $regionModel; public function __construct() { $this->model = new Client(); $this->regionModel = new ClientRegion(); } protected function saveModel($sp12db67, $sp68be9c) { foreach ($sp68be9c as $sp22c61b => $sp75a6c8) { $sp12db67->{$sp22c61b} = $sp75a6c8; } $sp12db67->save(); return $sp12db67; } public function store($sp68be9c) { $sp12db67 = $this->saveModel(new $this->model(), $sp68be9c); return $sp12db67; } public function storeRegional($sp68be9c) { $sp12db67 = $this->saveModel(new $this->regionModel(), $sp68be9c); return $sp12db67; } public function update($sp12db67, $sp68be9c) { $sp12db67 = $this->saveModel($sp12db67, $sp68be9c); return $sp12db67; } public function findAll() { return $this->model->orderBy('client_name', 'asc')->get(); } public function findById($sp2bf607) { return $this->model->where('id', $sp2bf607)->first(); } public function findRegionById($sp2bf607) { return $this->regionModel->where('id', $sp2bf607)->first(); } public function findAllRegionParent() { return $this->regionModel->where('is_parent', true)->orderBy('region_name', 'asc')->get(); } public function getClientList($spe81ede = '', $sp0757f9 = '') { if ($spe81ede == '' && $sp0757f9 == '') { $spe88479 = $this->model->query(); } else { $spe88479 = $this->model; if ($spe81ede != '') { $spe88479 = $spe88479->whereDate('created_at', '>=', trim($spe81ede)); } if ($sp0757f9 != '') { $spe88479 = $spe88479->whereDate('created_at', '<=', trim($sp0757f9)); } } $sp68be9c = DataTables::eloquent($spe88479)->addColumn('action', function ($sp12db67) { return view('client.action')->with('model', $sp12db67); })->make(true); return $sp68be9c; } public function getRegionList($spe81ede = '', $sp0757f9 = '') { if ($spe81ede == '' && $sp0757f9 == '') { $spe88479 = $this->regionModel->query(); } else { $spe88479 = $this->regionModel; if ($spe81ede != '') { $spe88479 = $spe88479->whereDate('created_at', '>=', trim($spe81ede)); } if ($sp0757f9 != '') { $spe88479 = $spe88479->whereDate('created_at', '<=', trim($sp0757f9)); } } $sp68be9c = DataTables::eloquent($spe88479)->addColumn('action', function ($sp12db67) { return view('client.regionAction')->with('model', $sp12db67); })->addColumn('parent_name', function ($sp12db67) { if ($sp12db67->is_parent) { return 'Daerah parent'; } else { $sp58c336 = $sp12db67->parentRegion(); if ($sp58c336) { return $sp58c336->region_name; } else { return 'Parent tidak ditemukan.'; } } })->make(true); return $sp68be9c; } }