<?php
namespace App\Models; use Illuminate\Database\Eloquent\Model; class Purchase extends Model { protected $table = 'Purchase'; protected $fillable = array(); protected $hidden = array(); protected static $debtModel = 'App\\Models\\Debt'; protected static $supplierModel = 'App\\Models\\Supplier'; protected static $itemPurchaseHistoryModel = 'App\\Models\\ItemPurchaseHistory'; public function debt() { return $this->hasOne(static::$debtModel, 'purchase_id'); } public function items() { return $this->hasOne(static::$itemPurchaseHistoryModel, 'purchase_id'); } public function supplier() { return $this->belongsTo(static::$supplierModel, 'supplier_id'); } public function delete() { $spee7f22 = $this->items()->get(); if (count($spee7f22) > 0) { foreach ($spee7f22 as $spd145cb) { if ($spaa89da = $spd145cb->item) { $spaa89da->stock -= $spd145cb->quantity; if ($spaa89da->stock < 0) { $spaa89da->stock = 0; } $spaa89da->save(); } $spd145cb->delete(); } } $this->debt()->delete(); return parent::delete(); } }