<?php
namespace App\Http\Controllers; use Illuminate\Http\Request; class SiteController extends Controller { public function __construct() { parent::__construct(); $this->middleware('admin', array('except' => array('login', 'logout', 'postLogin'))); $this->middleware('admin.sales', array('only' => array('addSales', 'allSales', 'salesReport', 'addReceivable', 'allReceivable', 'allReceivableInvoice', 'receivableReport'))); $this->middleware('admin.purchase', array('only' => array('addPurchase', 'allPurchase', 'purchaseReport', 'addDebt', 'allDebt', 'allDebtInvoice'))); $this->middleware('admin.item', array('only' => array('addItem', 'allItem', 'itemReport', 'itemReportProfit'))); $this->middleware('admin.supplier', array('only' => array('addSupplier', 'allSupplier'))); $this->middleware('admin.client', array('only' => array('addClient', 'allClient', 'allClientRegional'))); $this->middleware('admin.user', array('only' => array('addUser', 'allUser'))); $this->middleware('admin.expense', array('only' => array('addExpense', 'allExpense', 'expenseReport'))); } public function login() { return view('login'); } public function postLogin() { $sp68be9c = \Input::get('data'); try { $sp7612e0 = \Sentinel::authenticate(array('email' => $sp68be9c['email'], 'password' => $sp68be9c['password']), isset($sp68be9c['remember'])); if (!$sp7612e0) { throw new \Exception('User tidak ditemukan / password salah.', 1); return false; } if ($sp7612e0->is_ban) { throw new \Exception('User diban.', 1); return false; } } catch (\Exception $sp118c46) { if (isset($sp7612e0)) { \Sentinel::logout(); } return \Response::json(array('type' => 'error', 'message' => $sp118c46->getMessage())); } return \Response::json(array('type' => 'success', 'message' => 'Login sukses.', 'redirect' => route('home'))); } public function logout() { if ($sp7612e0 = \Sentinel::getUser()) { \Sentinel::logout($sp7612e0); } return redirect(route('login'))->with('flashMessage', array('class' => 'success', 'message' => 'User telah logout.')); } public function home() { return view('home'); } public function settings() { return view('settings'); } public function updateSettings() { $sp7612e0 = \Sentinel::getUser(); $sp68be9c = \Input::get('data'); try { \Sentinel::update($sp7612e0, array('password' => $sp68be9c['password'])); } catch (\Exception $sp118c46) { return \Response::json(array('type' => 'error', 'message' => $sp118c46->getMessage())); } return \Response::json(array('type' => 'success', 'message' => 'Akun berhasil diupdate.')); } public function addSales() { return view('sales.add'); } public function allSales() { return view('sales.all'); } public function salesReport() { return view('sales.report'); } public function addPurchase() { return view('purchase.add'); } public function allPurchase() { return view('purchase.all'); } public function purchaseReport() { return view('purchase.report'); } public function addReceivable() { return view('receivable.add'); } public function allReceivable() { return view('receivable.all'); } public function allReceivableInvoice() { return view('receivable.invoiceAll'); } public function receivableReport() { return view('receivable.report'); } public function addDebt() { return view('debt.add'); } public function allDebt() { return view('debt.all'); } public function allDebtInvoice() { return view('debt.invoiceAll'); } public function addItem() { return view('item.add'); } public function allItem() { return view('item.all'); } public function itemReport() { return view('item.report'); } public function itemReportProfit() { return view('item.reportProfit'); } public function addSupplier() { return view('supplier.add'); } public function allSupplier() { return view('supplier.all'); } public function addClient() { return view('client.add'); } public function allClient() { return view('client.all'); } public function allClientRegional() { return view('client.regional'); } public function addExpense() { return view('expense.add'); } public function allExpense() { return view('expense.all'); } public function expenseReport() { return view('expense.report'); } public function addUser() { return view('user.add'); } public function allUser() { return view('user.all'); } }